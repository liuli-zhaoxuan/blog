# 基于STC32的平衡车项目总结

从7月1日开始，我就计划了和川老师做两个项目，基于STC32的循迹小车和平衡车，电路的设计都交给了川老师，我打算在程序算法上多出点力。最后，**项目以失败告终**，写下这篇博客好好总结一下平衡车项目遇到的问题。

## 一、硬件设计

硬件电路虽然都由川老师来设计，我检查了一遍，但是还是出现了如下问题：

1. 开关电源是一个拨动开关，有一个引脚应该悬空，但是接地了，导致电源短路，然后在焊接完成之后，发现冒烟了，电池滚烫，差点就能看见稳压芯片被点亮。随着空气中的焦味弥散，只能更换稳压芯片，同时这个开关只能常开了。这个问题是我们**电路设计粗心**，经验不足。
2. 下载口是用串口一，用串口下载模块去接板子上的四个针脚，同时**没有加复位按键**，开关损坏的情况下，导致我在每次烧录完代码的时候都需要用手去拔排母线，很不方便。所以以后我画板子还是加一个ch340串口下载芯片和复位引脚，还是很有必要的。
3. 对于电机的**电源**，我们没有做处理，导致了整个项目从一开始就是失败的。因为随着电池电量的消耗，电源直接供给给电机的电压就会下降，这样的不稳定导致了最后直立环和速度环根本就没有办法调好。

## 二、软件编程

原本我以为项目难点会是在PID算法上，但是结果难倒我的却是IIC协议。

1. 按照我的想法，首先我要测试的模块是OLED显示屏，因为屏幕可以方便我调试。SSD1315屏幕，网上有很多基于STM32的例程，我本以为改一下例程就能解决，结果一直调不出来。于是陷入了死胡同，我反复看IIC协议还有STC32的数据手册，尝试了用硬件IIC和软件IIC两种方式去控制芯片，前后折腾了之后两个星期，结果依旧是黑屏。我怀疑是屏幕坏了，所以用手上的STM32测试了，是可以显示的。我一直觉得是我写错了程序，找了相当多的资料：github、CSDN、江科大、STC官方库还有datasheet，都没有解决。直到某天在床上想：我要测一下引脚输出到底对不对，我写的IIC时序有没有问题。于是周末跑到实验室借了个示波器，一测试发现，那两个引脚虚焊了。我真的欲哭无泪，得到的教训是：**对于嵌入式这样软硬结合的工作，思路视野一定要宽阔，不能总是盯着眼前的一点代码。**
2. 第二个就是放弃OLED之后，我想着只要陀螺仪可以工作就行。陀螺仪模块使用的是MPU6050，在川老师STM32平衡车上面已经测试过了，是能使用的。它也是使用IIC进行通信的，我改写江科大的例程，初始化了MPU6050模块，查询了WHO AM I寄存器情况，结果返回了正确是值(ASCLL码是h)，但是无法获取XYZ轴的数据。通过串口打印调试法，我发现程序卡在了读取数据的函数上，模块没有返回值。做到这，我们也发现了电机电压的问题，所以也就兴致全无，正式宣布该项目失败。

## 三、其他方面

1. 首先是我资料收集的能力，一开始对着datasheet编程，虽然点亮一个灯确实让我高兴。但是如果能耐心看看网上的教程，会发现其实是有STC32的库函数的，我就不需要绕那么多弯路了。
2. 购买零件的时候，没有仔细核对引脚，导致电机驱动芯片正好反了，用不上，只能换一个了。
3. 这个项目作为合作项目，我总是想着川老师完成硬件就够了，软件全交给我。但是奈何我能力有限，其实应该主动寻求帮助，主动得将我能够用上的力量都调动起来。

## 四、收获

这个项目的具体进度可以在我的暑假学习笔记的日志中查看，大部分时间都在折腾OLED屏幕，每个晚上都特别难熬，有强烈的碰壁感和挫败感。但是回头看，我还是收获了很多东西，首先就是经验增加了，今天记录下来的问题，以后就有了指导；其次，我将我在实验室项目中学会的3D建模能力用来设计了平衡车的底板，并且一次就成功，设计思路比较缜密，还是很有成就感的；最后，这一个月伴随这项目的推进，我过得很充实，白天做实验室的活，晚上锻炼、玩单片机，即使这次结果不如意，但是我仍然能够怀着激情去面对之后的挑战。

